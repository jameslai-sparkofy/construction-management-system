<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¡ˆåˆ—è¡¨ - å…ƒå¿ƒå»ºæå·¥ç¨‹ç®¡ç†ç³»çµ±</title>
    
    <!-- å„ªåŒ–ç‰ˆæœ¬æ¨™è¨˜ -->
    <meta name="version" content="2.1-optimized">
    <meta name="description" content="å…ƒå¿ƒå»ºæå·¥ç¨‹ç®¡ç†ç³»çµ± - å„ªåŒ–è¼‰å…¥é€Ÿåº¦ç‰ˆæœ¬">
    
    <!-- é è¼‰å…¥é—œéµè³‡æº -->
    <link rel="preload" href="css/project-list-optimized.css" as="style">
    <link rel="preload" href="js/project-list-optimized.js" as="script">
    <link rel="preload" href="config.js" as="script">
    
    <!-- é—œéµ CSS å…§è¯ -->
    <style>
        /* é—œéµæ¸²æŸ“è·¯å¾‘ - æœ€å°åŒ– CSS */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
            background: #f9fafb;
            min-height: 100vh;
        }
        .loading { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            min-height: 60vh; 
        }
        .spinner { 
            border: 3px solid #e5e7eb; 
            border-top: 3px solid #84C7D0; 
            border-radius: 50%; 
            width: 50px; 
            height: 50px; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .header { 
            background: white; 
            padding: 1.5rem 2rem; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.08); 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
    </style>
    
    <!-- å»¶é²è¼‰å…¥å®Œæ•´æ¨£å¼ -->
    <link rel="stylesheet" href="css/project-list-optimized.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="css/project-list-optimized.css"></noscript>
    
    <!-- ç‰ˆæœ¬ç®¡ç† -->
    <script src="js/version-manager.js" async></script>
</head>
<body>
    <!-- å¿«é€Ÿè¼‰å…¥çš„åŸºæœ¬çµæ§‹ -->
    <div class="header">
        <div class="header-content">
            <h1>
                <span class="desktop-title">å…ƒå¿ƒå·¥ç¨‹å°ˆæ¡ˆ</span>
                <span class="mobile-title">å…ƒå¿ƒå·¥ç¨‹å°ˆæ¡ˆ</span>
                <span class="version" style="font-size: 0.6em; color: #84C7D0;">v2.1</span>
            </h1>
            <div class="header-right-section" style="display: flex; align-items: center; gap: 0.75rem;">
                <!-- ç®¡ç†åŠŸèƒ½é¸å–® -->
                <div class="admin-menu" id="adminMenu" style="display: none;">
                    <button class="admin-btn" onclick="toggleAdminDropdown()" id="adminBtn">
                        ğŸ”§ ç®¡ç†åŠŸèƒ½
                    </button>
                    <div class="admin-dropdown" id="adminDropdown">
                        <a href="global-user-management.html" class="admin-dropdown-item">ğŸ‘¤ ç”¨æˆ¶ç®¡ç†</a>
                        <a href="global-project-user-management.html" class="admin-dropdown-item">ğŸ—ï¸ å°ˆæ¡ˆç”¨æˆ¶ç®¡ç†</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å®¹å™¨ -->
    <div class="container">
        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalProjects">â³</div>
                <div class="stat-label">ç¸½å°ˆæ¡ˆæ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="notStartedProjects">â³</div>
                <div class="stat-label">å°šæœªé–‹å§‹</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="inProgressProjects">â³</div>
                <div class="stat-label">æ–½å·¥ä¸­</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completedProjects">â³</div>
                <div class="stat-label">å·²å®Œå·¥</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="maintenanceProjects">â³</div>
                <div class="stat-label">ç¶­ä¿®ä¸­</div>
            </div>
        </div>

        <!-- ç‹€æ…‹æ¨™ç±¤ -->
        <div class="status-tabs">
            <button class="tab-btn" data-status="all">å…¨éƒ¨å°ˆæ¡ˆ</button>
            <button class="tab-btn" data-status="not_started">å°šæœªé–‹å§‹</button>
            <button class="tab-btn active" data-status="in_progress">æ–½å·¥ä¸­</button>
            <button class="tab-btn" data-status="maintenance">ç¶­ä¿®ä¸­</button>
            <button class="tab-btn" data-status="completed">å·²å®Œå·¥</button>
        </div>

        <!-- æœå°‹å’Œæ“ä½œ -->
        <div class="controls">
            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" placeholder="æœå°‹å°ˆæ¡ˆåç¨±æˆ–å…¬å¸..." id="searchInput">
            </div>
            <button class="btn-primary" onclick="window.location.href='project-create-simple.html'">
                <span>â•</span> å»ºç«‹æ–°å°ˆæ¡ˆ
            </button>
        </div>

        <!-- è¼‰å…¥ç‹€æ…‹ -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div class="loading-text">è¼‰å…¥å°ˆæ¡ˆä¸­...</div>
        </div>

        <!-- å°ˆæ¡ˆå®¹å™¨ -->
        <div class="projects-container" id="projectsContainer" style="display: none;">
            <div class="projects-grid" id="projectsGrid">
                <!-- å‹•æ…‹è¼‰å…¥å°ˆæ¡ˆå¡ç‰‡ -->
            </div>
        </div>

        <!-- ç©ºç‹€æ…‹ -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">ğŸ“‹</div>
            <div class="empty-title">å°šç„¡å°ˆæ¡ˆ</div>
            <div class="empty-desc">ç›®å‰æ²’æœ‰ä»»ä½•å°ˆæ¡ˆï¼Œé»æ“Šä¸Šæ–¹æŒ‰éˆ•å»ºç«‹æ–°å°ˆæ¡ˆ</div>
            <button class="btn-primary" onclick="window.location.href='project-create-simple.html'">
                å»ºç«‹ç¬¬ä¸€å€‹å°ˆæ¡ˆ
            </button>
        </div>
    </div>

    <!-- é—œéµè…³æœ¬ - æŒ‰å„ªå…ˆé †åºè¼‰å…¥ -->
    <script>
        // å…§è¯é—œéµé…ç½®ä»¥é¿å…é˜»å¡
        window.CONFIG = window.CONFIG || {};
        
        // è¼‰å…¥é€²åº¦æŒ‡ç¤ºå™¨
        let loadedScripts = 0;
        const totalScripts = 5;
        
        function updateLoadProgress() {
            loadedScripts++;
            const progress = (loadedScripts / totalScripts) * 100;
            console.log(`è¼‰å…¥é€²åº¦: ${progress.toFixed(0)}%`);
        }
        
        // è…³æœ¬è¼‰å…¥éŒ¯èª¤è™•ç†
        function handleScriptError(scriptName) {
            console.error(`è…³æœ¬è¼‰å…¥å¤±æ•—: ${scriptName}`);
            
            // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
            const loading = document.getElementById('loading');
            if (loading) {
                loading.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
                        <div style="font-size: 1.2rem; color: #dc2626; margin-bottom: 1rem;">è¼‰å…¥å¤±æ•—</div>
                        <div style="color: #6b7280; margin-bottom: 2rem;">ç„¡æ³•è¼‰å…¥å¿…è¦è³‡æºï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š</div>
                        <button onclick="location.reload()" style="padding: 0.75rem 1.5rem; background: #84C7D0; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            é‡æ–°è¼‰å…¥
                        </button>
                    </div>
                `;
            }
        }
    </script>

    <!-- æŒ‰é †åºè¼‰å…¥è…³æœ¬ -->
    <script src="config.js" 
            onload="updateLoadProgress()" 
            onerror="handleScriptError('config.js')"></script>
    
    <script src="js/unified-auth.js" 
            onload="updateLoadProgress()" 
            onerror="handleScriptError('unified-auth.js')" async></script>
    
    <script src="js/unified-permissions.js" 
            onload="updateLoadProgress()" 
            onerror="handleScriptError('unified-permissions.js')" async></script>
    
    <script src="js/project-status.js" 
            onload="updateLoadProgress()" 
            onerror="handleScriptError('project-status.js')" async></script>
    
    <script src="js/user-profile-component.js" 
            onload="updateLoadProgress()" 
            onerror="handleScriptError('user-profile-component.js')" async></script>

    <!-- ä¸»è¦æ‡‰ç”¨ç¨‹å¼è…³æœ¬ - å»¶é²è¼‰å…¥ -->
    <script src="js/project-list-optimized.js" 
            onload="updateLoadProgress()" 
            onerror="handleScriptError('project-list-optimized.js')" 
            defer></script>

    <!-- ç®¡ç†åŠŸèƒ½è…³æœ¬ - å…§è¯ä»¥æ¸›å°‘è«‹æ±‚ -->
    <script>
        // ç®¡ç†åŠŸèƒ½åˆ‡æ›
        function toggleAdminDropdown() {
            const dropdown = document.getElementById('adminDropdown');
            const adminBtn = document.getElementById('adminBtn');
            
            if (dropdown && adminBtn) {
                dropdown.classList.toggle('show');
                adminBtn.classList.toggle('active');
            }
        }

        // å…¨åŸŸé»æ“Šé—œé–‰ä¸‹æ‹‰é¸å–®
        document.addEventListener('click', function(event) {
            const adminMenu = document.getElementById('adminMenu');
            const adminDropdown = document.getElementById('adminDropdown');
            const adminBtn = document.getElementById('adminBtn');
            
            if (adminMenu && adminDropdown && adminBtn && !adminMenu.contains(event.target)) {
                adminDropdown.classList.remove('show');
                adminBtn.classList.remove('active');
            }
        });

        // ç™»å‡ºåŠŸèƒ½
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                if (window.AuthUtils) {
                    window.AuthUtils.logout();
                } else {
                    localStorage.clear();
                }
                window.location.href = 'login-simple.html';
            }
        }

        // æ€§èƒ½ç›£æ§
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (typeof performance !== 'undefined' && performance.timing) {
                    const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                    console.log(`å®Œæ•´è¼‰å…¥æ™‚é–“: ${loadTime}ms`);
                    
                    // è¨˜éŒ„æ€§èƒ½æŒ‡æ¨™
                    if (loadTime > 3000) {
                        console.warn('è¼‰å…¥æ™‚é–“éé•·ï¼Œå»ºè­°é€²ä¸€æ­¥å„ªåŒ–');
                    }
                }
            }, 0);
        });
    </script>

    <!-- Service Worker æ”¯æ´ï¼ˆå¯é¸ï¼‰ -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker è¨»å†ŠæˆåŠŸ');
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker è¨»å†Šå¤±æ•—:', error);
                    });
            });
        }
    </script>
</body>
</html>