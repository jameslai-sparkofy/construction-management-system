# CRM 對象欄位對照表

本文檔詳細記錄了工程管理系統與紛享銷客 CRM 之間的對象欄位對照關係。

## 1. 工地師父 (object_50HJ8__c)

### 必填欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 租戶ID | tenant_id | 單行文本 | 系統租戶標識 |
| 對象API名稱 | object_describe_api_name | 單行文本 | 對象描述名稱 |
| 負責人 | owner | 人員 | 負責人員工ID |
| 姓名 | name | 單行文本 | 師父姓名 |

### 基本資訊欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 手機 | phone_number__c | 手機 | 聯絡電話 |
| 簡稱 | abbreviation__c | 單行文本 | 師父簡稱 |
| 密碼 | password__c | 單行文本 | 登入密碼 |
| 帳號 | account__c | 單行文本 | 登入帳號 |
| LINE UID | LINE_user_id__c | 單行文本 | LINE用戶ID |
| 頭像 | field_Imtt7__c | 圖片 | 個人頭像 |

### 關聯欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 屬於哪個工班 | field_D1087__c | 查找關聯 | 關聯到工班對象 |
| 連絡人 | field_HdgcK__c | 查找關聯 | 關聯連絡人 |

### 系統欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 創建時間 | create_time | 日期時間 | 記錄創建時間 |
| 最後修改時間 | last_modified_time | 日期時間 | 最後更新時間 |
| 創建人 | created_by | 人員 | 創建者 |
| 最後修改人 | last_modified_by | 人員 | 最後修改者 |
| 生命狀態 | life_status | 單選 | 未生效/審核中/正常/變更中/作廢 |
| 鎖定狀態 | lock_status | 單選 | 未鎖定/鎖定 |
| 是否刪除 | is_deleted | 布爾值 | 刪除標記 |

## 2. 案場(SPC) (object_8W9cb__c)

### 必填欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 租戶ID | tenant_id | 單行文本 | 系統租戶標識 |
| 對象API名稱 | object_describe_api_name | 單行文本 | 對象描述名稱 |
| 負責人 | owner | 人員 | 負責人員工ID |
| 編號 | name | 自增編號 | 案場編號（自動生成） |

### 施工管理欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 工班 | shift_time__c | 引用字段 | 關聯工班資訊 |
| 工班師父 | field_u1wpv__c | 單行文本 | 負責師父 |
| 施工日期 | field_23pFq__c | 日期 | 施工執行日期 |
| 施工完成 | construction_completed__c | 布爾值 | 完工標記 |
| 工班施工完備註 | work_shift_completion_note__c | 多行文本 | 完工說明 |

### 照片管理欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 施工前照片 | field_V3d91__c | 圖片 | 施工前現場照 |
| 完工照片 | field_3Fqof__c | 圖片 | 完工後照片 |
| 驗收照片 | field_v1x3S__c | 圖片 | 驗收時照片 |
| 工地狀況照片(施工前) | field_03U9h__c | 圖片 | 施工前狀況記錄 |
| 工地狀況照片(施工後) | construction_difficulty_ph__c | 圖片 | 施工後狀況記錄 |
| 施工前缺失 | field_W2i6j__c | 圖片 | 缺失照片記錄 |
| 平面圖 | field_3T38o__c | 圖片 | 場地平面圖 |
| 缺失影片 | field_1zk34__c | 附件 | 缺失影片檔案 |

### 案場基本資訊
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 棟別 | field_WD7k1__c | 單行文本 | 建築棟別 |
| 樓層 | field_Q6Svh__c | 數字 | 樓層數 |
| 戶別 | field_XuJP2__c | 單行文本 | 戶號 |
| 工地坪數 | field_tXAko__c | 數字 | 總面積（坪） |
| 舖設坪數 | field_B2gh1__c | 數字 | 實際施工面積 |
| 保護板坪數 | field_27g6n__c | 數字 | 保護板面積 |
| 少請坪數 | field_i2Q1g__c | 計算字段 | 自動計算差額 |

### 狀態與階段管理
| 欄位名稱 | API Name | 類型 | 選項值 |
|---------|----------|------|--------|
| 階段 | field_z9H6O__c | 單選 | 準備中/施工前場勘/施工/驗收/缺失維修/其他 |
| 標籤 | field_23Z5i__c | 多選 | 準備中/不可施工/可施工/已完工/需維修/維修完成/其他 |
| 案場類型 | field_dxr31__c | 單選 | 工地/樣品屋/民宅/其他 |

### 備註欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 施工前備註 | field_sF6fn__c | 單行文本 | 施工前注意事項 |
| 工地備註 | field_g18hX__c | 多行文本 | 現場狀況說明 |
| 驗收備註 | field_n37jC__c | 單行文本 | 驗收注意事項 |
| 修改記錄 | modification_record__c | 大文本 | 變更歷史記錄 |

### 業務關聯欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 商機 | field_1P96q__c | 查找關聯 | 關聯商機對象 |
| 工單 | field_k7e6q__c | 查找關聯 | 關聯工單對象 |
| 請款單 | field_npLvn__c | 查找關聯 | 關聯請款單對象 |

### 其他欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 保固日期 | field_f0mz3__c | 日期 | 保固到期日 |
| 做壞案場 | bad_case_scene__c | 布爾值 | 問題案場標記 |

### 系統欄位
| 欄位名稱 | API Name | 類型 | 說明 |
|---------|----------|------|------|
| 創建時間 | create_time | 日期時間 | 記錄創建時間 |
| 最後修改時間 | last_modified_time | 日期時間 | 最後更新時間 |
| 創建人 | created_by | 人員 | 創建者 |
| 最後修改人 | last_modified_by | 人員 | 最後修改者 |
| 生命狀態 | life_status | 單選 | 未生效/審核中/正常/變更中/作廢 |
| 鎖定狀態 | lock_status | 單選 | 未鎖定/鎖定 |
| 是否刪除 | is_deleted | 布爾值 | 刪除標記 |
| 數據來源 | origin_source | 單選 | 數據同步 |

## 3. API 整合注意事項

### 3.1 創建記錄時的必填欄位
```javascript
// 工地師父
{
  "tenant_id": "系統自動填入",
  "object_describe_api_name": "object_50HJ8__c",
  "owner": ["FSUID_xxx"], // 人員ID陣列
  "name": "師父姓名"
}

// 案場(SPC)
{
  "tenant_id": "系統自動填入",
  "object_describe_api_name": "object_8W9cb__c",
  "owner": ["FSUID_xxx"], // 人員ID陣列
  "name": "自動生成編號"
}
```

### 3.2 更新記錄注意事項
1. 更新時不需要傳送所有欄位，只需傳送要更新的欄位
2. 系統欄位（如 create_time, created_by 等）由系統自動維護
3. 圖片和附件欄位需要先上傳到 R2，然後傳送 URL

### 3.3 欄位類型說明
- **單行文本**: 最大長度 255 字符
- **多行文本**: 最大長度 2000 字符
- **大文本**: 最大長度 65535 字符
- **數字**: 整數或小數
- **日期**: YYYY-MM-DD 格式
- **日期時間**: 時間戳格式（毫秒）
- **布爾值**: true/false
- **單選/多選**: 必須使用預定義的選項值
- **人員**: 用戶ID，格式為 FSUID_xxx
- **查找關聯**: 關聯對象的 ID
- **圖片/附件**: URL 字符串

## 4. 同步策略

### 4.1 防循環同步
- 檢查 30 秒內是否有來自 webhook 的相同更新
- 如果檢測到循環，跳過同步操作

### 4.2 錯誤處理
- API 調用失敗時實施指數退避重試（最多 3 次）
- 記錄所有同步操作到 sync_logs 表
- 提供離線隊列機制處理網絡故障

### 4.3 批量操作
- 批量更新時控制並發請求數量
- 每批次最多 50 條記錄
- 使用事務確保數據一致性

## 5. 更新歷史
- 2025-01-21: 初始版本，基於 CSV 檔案整理
- 文檔版本: 1.0.0